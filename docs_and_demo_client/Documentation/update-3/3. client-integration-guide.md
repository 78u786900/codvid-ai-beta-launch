# Client Integration Guide for Instagram Tracking

This document provides step-by-step instructions for integrating Instagram tracking functionality into any client application, with code examples for different platforms and programming languages.

## Prerequisites

### What You Need
1. **HTTP Client**: Any library that supports REST API calls (fetch, axios, requests, etc.)
2. **JWT Authentication**: Working authentication system that provides JWT tokens
3. **JSON Support**: Ability to send and parse JSON data
4. **Schema Version**: Use "4.0" for all POST/PUT requests

### HTTP Methods Required

Your HTTP client must support these methods:
- **GET**: For retrieving data (tasks, details, sentiment)
- **POST**: For creating tasks and triggering actions
- **PUT**: For updating existing tasks
- **DELETE**: For removing tasks

### HTTP Client Requirements

Your HTTP client needs to support:
- GET, POST, PUT, DELETE methods
- JSON request/response handling  
- Authorization header: `Bearer {jwt_token}`

## Basic Integration Steps

### Integration Steps

1. **Get JWT token** from your existing auth system
2. **Make API calls** to `/codvid-ai/ig-tracking/` endpoints
3. **Include Authorization header**: `Bearer {your_jwt_token}`
4. **Handle JSON responses** from the API

### Step 3: Create Helper Functions

```python
def create_tracking_task(target_profile: str, is_competitor: bool):
    """Create a new Instagram tracking task"""
    data = {
        "target_profile": target_profile,
        "is_competitor": is_competitor
    }
    
    response = network.send(
        "/codvid-ai/ig-tracking/create_task",
        content=data,
        session_token=session_token
    )
    
    result = response.get_dict()
    if result and result.get("result"):
        task_id = result["response"]["task_id"]
        print(f"✓ Created tracking task for @{target_profile}")
        print(f"  Task ID: {task_id}")
        return task_id
    else:
        error_msg = result.get("message", "Unknown error") if result else "No response"
        print(f"❌ Failed to create task: {error_msg}")
        return None

def get_tracking_tasks():
    """Get all tracking tasks for the user"""
    response = network.send(
        "/codvid-ai/ig-tracking/get_tasks",
        session_token=session_token,
        method="GET"
    )
    
    result = response.get_dict()
    if result and result.get("result"):
        tasks = result["response"]["tasks"]
        print(f"✓ Found {len(tasks)} tracking tasks")
        return tasks
    else:
        error_msg = result.get("message", "Unknown error") if result else "No response"
        print(f"❌ Failed to get tasks: {error_msg}")
        return []

def get_task_details(task_id: str):
    """Get detailed information about a specific task"""
    response = network.send(
        f"/codvid-ai/ig-tracking/get_task/{task_id}",
        session_token=session_token,
        method="GET"
    )
    
    result = response.get_dict()
    if result and result.get("result"):
        return result["response"]["task"]
    else:
        error_msg = result.get("message", "Unknown error") if result else "No response"
        print(f"❌ Failed to get task details: {error_msg}")
        return None

def force_scrape_task(task_id: str):
    """Force immediate scraping of a task"""
    response = network.send(
        f"/codvid-ai/ig-tracking/force_scrape/{task_id}",
        content={},
        session_token=session_token
    )
    
    result = response.get_dict()
    if result and result.get("result"):
        print("✓ Task scraping completed successfully")
        return True
    else:
        error_msg = result.get("message", "Unknown error") if result else "No response"
        print(f"❌ Failed to scrape task: {error_msg}")
        return False

def get_sentiment_summary(task_id: str):
    """Get sentiment analysis summary for a task"""
    response = network.send(
        f"/codvid-ai/ig-tracking/sentiment_summary/{task_id}",
        session_token=session_token,
        method="GET"
    )
    
    result = response.get_dict()
    if result and result.get("result"):
        return result["response"]["sentiment_summary"]
    else:
        error_msg = result.get("message", "Unknown error") if result else "No response"
        print(f"❌ Failed to get sentiment summary: {error_msg}")
        return None

def delete_tracking_task(task_id: str):
    """Delete a tracking task"""
    response = network.send(
        f"/codvid-ai/ig-tracking/delete_task/{task_id}",
        session_token=session_token,
        method="DELETE"
    )
    
    result = response.get_dict()
    if result and result.get("result"):
        print("✓ Task deleted successfully!")
        return True
    else:
        error_msg = result.get("message", "Unknown error") if result else "No response"
        print(f"❌ Failed to delete task: {error_msg}")
        return False
```

## Usage Examples

### Example 1: Basic Task Creation and Management

```python
# Create tracking tasks
own_profile_task = create_tracking_task("your_instagram_username", is_competitor=False)
competitor_task = create_tracking_task("competitor_username", is_competitor=True)

# Get all tasks
tasks = get_tracking_tasks()

# Display task information
for task in tasks:
    profile_type = "🏢 Competitor" if task['is_competitor'] else "👤 Own Profile"
    status = "✅ Active" if task['status'] == 'active' else "⏸️ Inactive"
    
    print(f"{status} @{task['target_profile']} ({profile_type})")
    print(f"   📅 Created: {task['created_at']}")
    print(f"   🔄 Last Scraped: {task.get('last_scraped', 'Never')}")
    print()
```

### Example 2: Force Scraping and Analysis

```python
# Get task ID (from previous examples or user input)
task_id = own_profile_task

if task_id:
    print("🔄 Starting forced scraping...")
    
    # Force scrape the task
    if force_scrape_task(task_id):
        print("✅ Scraping completed! Getting results...")
        
        # Get detailed task information
        task_details = get_task_details(task_id)
        
        if task_details and task_details.get('scraped_posts'):
            print(f"📱 Profile: @{task_details['target_profile']}")
            print(f"📊 Posts found: {len(task_details['scraped_posts'])}")
            
            # Display post information
            for i, post in enumerate(task_details['scraped_posts'], 1):
                print(f"\n📝 Post {i}:")
                print(f"   🔗 URL: {post['post_url']}")
                print(f"   📅 Date: {post['timestamp']}")
                print(f"   📱 Type: {post['type']}")
                print(f"   ❤️ Likes: {post['likes_count']:,}")
                print(f"   💬 Comments: {post['comments_count']}")
                
                if post.get('video_view_count'):
                    print(f"   👀 Views: {post['video_view_count']:,}")
                
                # Display top comments
                if post.get('top_comments'):
                    print(f"   💬 Top Comments ({len(post['top_comments'])}):")
                    for j, comment in enumerate(post['top_comments'][:3], 1):
                        sentiment_emoji = {"positive": "😊", "negative": "😞", "neutral": "😐"}
                        emoji = sentiment_emoji.get(comment['sentiment'], "😐")
                        print(f"      {j}. {emoji} @{comment['owner_username']}: {comment['text'][:50]}...")
        else:
            print("❌ No scraped data available yet.")
```

### Example 3: Sentiment Analysis and Comparison

```python
def analyze_and_compare_profiles():
    """Analyze sentiment across all tracked profiles"""
    tasks = get_tracking_tasks()
    
    if not tasks:
        print("❌ No tracking tasks found.")
        return
    
    print("📊 Sentiment Analysis Comparison")
    print("=" * 50)
    
    profiles_data = []
    
    for task in tasks:
        task_id = task['_id']
        profile_name = task['target_profile']
        
        # Only analyze tasks that have been scraped
        if task.get('last_scraped'):
            sentiment_summary = get_sentiment_summary(task_id)
            
            if sentiment_summary:
                profiles_data.append({
                    'profile': profile_name,
                    'is_competitor': task['is_competitor'],
                    'sentiment': sentiment_summary
                })
    
    if not profiles_data:
        print("❌ No profiles with sentiment data found.")
        return
    
    # Sort by positive sentiment percentage
    profiles_data.sort(key=lambda x: x['sentiment']['sentiment_percentages']['positive'], reverse=True)
    
    # Display comparison results
    for data in profiles_data:
        profile = data['profile']
        sentiment = data['sentiment']
        profile_type = "🏢 Competitor" if data['is_competitor'] else "👤 Own Profile"
        
        print(f"\n📱 @{profile} ({profile_type})")
        print(f"   📊 {sentiment['total_comments']} comments analyzed")
        print(f"   😊 Positive: {sentiment['sentiment_percentages']['positive']:.1f}%")
        print(f"   😐 Neutral:  {sentiment['sentiment_percentages']['neutral']:.1f}%")
        print(f"   😞 Negative: {sentiment['sentiment_percentages']['negative']:.1f}%")
        print(f"   🎯 Overall: {sentiment['overall_sentiment'].upper()}")
    
    # Show best performing profile
    if len(profiles_data) > 1:
        best_profile = profiles_data[0]
        print(f"\n🏆 BEST PERFORMING: @{best_profile['profile']}")
        print(f"   {best_profile['sentiment']['sentiment_percentages']['positive']:.1f}% positive sentiment")

# Run the analysis
analyze_and_compare_profiles()
```

### Example 4: Task Management and Cleanup

```python
def interactive_task_management():
    """Interactive task management interface"""
    while True:
        print("\n🛠️ Task Management")
        print("1. View all tasks")
        print("2. Create new task")
        print("3. Delete task")
        print("4. Force scrape task")
        print("5. Exit")
        
        choice = input("Enter your choice (1-5): ").strip()
        
        if choice == "1":
            # View all tasks
            tasks = get_tracking_tasks()
            if tasks:
                for i, task in enumerate(tasks, 1):
                    status = "✅" if task.get('last_scraped') else "⏳"
                    type_emoji = "🏢" if task['is_competitor'] else "👤"
                    print(f"   {i}. {status} {type_emoji} @{task['target_profile']}")
            
        elif choice == "2":
            # Create new task
            profile = input("Enter Instagram username: ").strip()
            is_comp = input("Is this a competitor? (y/n): ").lower().startswith('y')
            create_tracking_task(profile, is_comp)
            
        elif choice == "3":
            # Delete task
            tasks = get_tracking_tasks()
            if tasks:
                print("Select task to delete:")
                for i, task in enumerate(tasks, 1):
                    print(f"   {i}. @{task['target_profile']}")
                
                try:
                    idx = int(input("Enter task number: ")) - 1
                    if 0 <= idx < len(tasks):
                        task_id = tasks[idx]['_id']
                        profile = tasks[idx]['target_profile']
                        
                        confirm = input(f"Delete @{profile}? (y/n): ").lower().startswith('y')
                        if confirm:
                            delete_tracking_task(task_id)
                    else:
                        print("❌ Invalid task number")
                except ValueError:
                    print("❌ Please enter a valid number")
            
        elif choice == "4":
            # Force scrape task
            tasks = get_tracking_tasks()
            if tasks:
                print("Select task to scrape:")
                for i, task in enumerate(tasks, 1):
                    print(f"   {i}. @{task['target_profile']}")
                
                try:
                    idx = int(input("Enter task number: ")) - 1
                    if 0 <= idx < len(tasks):
                        task_id = tasks[idx]['_id']
                        force_scrape_task(task_id)
                    else:
                        print("❌ Invalid task number")
                except ValueError:
                    print("❌ Please enter a valid number")
            
        elif choice == "5":
            print("👋 Goodbye!")
            break
        
        else:
            print("❌ Invalid choice. Please try again.")

# Run interactive management
interactive_task_management()
```

## Error Handling Best Practices

### Robust Error Handling Pattern

```python
def safe_instagram_operation(operation_func, *args, **kwargs):
    """Wrapper for safe Instagram tracking operations"""
    try:
        return operation_func(*args, **kwargs)
    except requests.exceptions.ConnectionError:
        print("❌ Connection error. Please check your internet connection.")
        return None
    except requests.exceptions.Timeout:
        print("❌ Request timeout. The server might be busy.")
        return None
    except requests.exceptions.RequestException as e:
        print(f"❌ Request failed: {str(e)}")
        return None
    except Exception as e:
        print(f"❌ Unexpected error: {str(e)}")
        return None

# Usage example
tasks = safe_instagram_operation(get_tracking_tasks)
if tasks is not None:
    print(f"Successfully retrieved {len(tasks)} tasks")
```

### Authentication Error Handling

```python
def check_authentication():
    """Check if authentication is still valid"""
    test_response = network.send(
        "/codvid-ai/ig-tracking/get_tasks",
        session_token=session_token,
        method="GET"
    )
    
    result = test_response.get_dict()
    if result and "Unauthorized" in str(result.get("message", "")):
        print("❌ Authentication expired. Please login again.")
        return False
    
    return True

# Use before important operations
if not check_authentication():
    # Re-authenticate user
    success = client.login(email, password)
    if not success:
        print("❌ Re-authentication failed")
        exit()
```

## Tips

- **Cache responses** locally to avoid repeated API calls
- **Use `get_tasks`** to get all tasks at once instead of individual calls
- **Server handles rate limiting** - no need to worry about API limits

## Summary

Simple REST API integration:
1. Use your existing JWT auth
2. Call the 7 Instagram tracking endpoints  
3. Handle JSON responses
4. Server manages all data processing automatically

See the detailed API reference and demo notebook for complete examples.