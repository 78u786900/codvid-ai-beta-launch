# Instagram Tracking API Reference

This document provides complete API reference for all Instagram tracking endpoints. Use this as your integration guide for connecting your client application to the Instagram tracking system.

## Authentication Requirements

All endpoints require JWT authentication in the Authorization header:
```
Authorization: Bearer <your_jwt_token>
```

## Base URL Structure

All Instagram tracking endpoints use this prefix:
```
/codvid-ai/ig-tracking/
```

**Complete endpoint URLs:**
```
POST   /codvid-ai/ig-tracking/create_task
GET    /codvid-ai/ig-tracking/get_tasks
GET    /codvid-ai/ig-tracking/get_task/<task_id>
DELETE /codvid-ai/ig-tracking/delete_task/<task_id>
PUT    /codvid-ai/ig-tracking/update_task/<task_id>
POST   /codvid-ai/ig-tracking/force_scrape/<task_id>
GET    /codvid-ai/ig-tracking/sentiment_summary/<task_id>
```

---

## 1. Create Tracking Task

**Endpoint:** `POST /codvid-ai/ig-tracking/create_task`

**Description:** Creates a new Instagram tracking task for monitoring a specific Instagram profile.

**Request:**
```json
{
  "schema_version": "4.0",
  "data": {
    "target_profile": "instagram_username",
    "is_competitor": true
  }
}
```

**Request Parameters:**
- `target_profile` (string, required): Instagram username to track (without @ symbol)
- `is_competitor` (boolean, required): Whether this profile belongs to a competitor (true) or the user (false)

**Success Response (200):**
```json
{
  "result": true,
  "response": {
    "task_id": "uuid-1234-5678-9abc",
    "message": "Instagram tracking task created successfully",
    "target_profile": "instagram_username",
    "next_scrape_due": "2025-08-03T12:00:00Z"
  }
}
```

**Error Responses:**
```json
// Missing required fields (400)
{
  "result": false,
  "message": "Missing required field: target_profile"
}

// Invalid profile name (400)
{
  "result": false,
  "message": "Invalid Instagram profile name"
}

// Unauthorized (401)
{
  "result": false,
  "message": "Unauthorized: invalid or expired token"
}
```

**Example Usage:**
```python
data = {
    "target_profile": "foodxtaste",
    "is_competitor": False
}
response = network.send(
    "/codvid-ai/ig-tracking/create_task",
    content=data,
    session_token=session_token
)
task_id = response.get_dict()["response"]["task_id"]
```

---

## 2. Get User's Tracking Tasks

**Endpoint:** `GET /codvid-ai/ig-tracking/get_tasks`

**Description:** Retrieves all Instagram tracking tasks for the authenticated user.

**Request:** No JSON body required (GET request)

**Success Response (200):**
```json
{
  "result": true,
  "response": {
    "tasks": [
      {
        "_id": "uuid-1234-5678-9abc",
        "target_profile": "instagram_username",
        "is_competitor": true,
        "created_at": "2025-08-01T12:00:00Z",
        "last_scraped": "2025-08-01T14:00:00Z",
        "next_scrape_due": "2025-08-03T14:00:00Z",
        "status": "active"
      }
    ],
    "total_tasks": 1
  }
}
```

**Error Responses:**
```json
// No tasks found (200 - not an error)
{
  "result": true,
  "response": {
    "tasks": [],
    "total_tasks": 0
  }
}

// Unauthorized (401)
{
  "result": false,
  "message": "Unauthorized: invalid or expired token"
}
```

**Example Usage:**
```python
response = network.send(
    "/codvid-ai/ig-tracking/get_tasks",
    session_token=session_token,
    method="GET"
)
tasks = response.get_dict()["response"]["tasks"]
```

---

## 3. Get Detailed Task Information

**Endpoint:** `GET /codvid-ai/ig-tracking/get_task/<task_id>`

**Description:** Retrieves detailed information about a specific tracking task, including all scraped posts and comments.

**URL Parameters:**
- `task_id` (string, required): The UUID of the tracking task

**Request:** No JSON body required (GET request)

**Success Response (200):**
```json
{
  "result": true,
  "response": {
    "task": {
      "_id": "uuid-1234-5678-9abc",
      "schema_version": "1.0",
      "user_id": "user-uuid",
      "target_profile": "instagram_username",
      "is_competitor": true,
      "created_at": "2025-08-01T12:00:00Z",
      "last_scraped": "2025-08-01T14:00:00Z",
      "next_scrape_due": "2025-08-03T14:00:00Z",
      "status": "active",
      "scraped_posts": [
        {
          "post_id": "abc123",
          "post_url": "https://instagram.com/p/abc123",
          "timestamp": "2025-07-30T08:00:00Z",
          "type": "reel",
          "caption": "Post caption text",
          "likes_count": 1234,
          "comments_count": 56,
          "video_view_count": 10000,
          "video_play_count": 8500,
          "hashtags": ["#food", "#tasty"],
          "mentions": ["@username"],
          "top_comments": [
            {
              "text": "Amazing product!",
              "sentiment": "positive",
              "owner_username": "commenter123",
              "timestamp": "2025-07-30T09:00:00Z",
              "likes_count": 5
            }
          ]
        }
      ]
    }
  }
}
```

**Error Responses:**
```json
// Task not found or access denied (404)
{
  "result": false,
  "message": "Task not found or access denied"
}

// Unauthorized (401)
{
  "result": false,
  "message": "Unauthorized: invalid or expired token"
}
```

**Example Usage:**
```python
task_id = "uuid-1234-5678-9abc"
response = network.send(
    f"/codvid-ai/ig-tracking/get_task/{task_id}",
    session_token=session_token,
    method="GET"
)
task_details = response.get_dict()["response"]["task"]
```

---

## 4. Delete Tracking Task

**Endpoint:** `DELETE /codvid-ai/ig-tracking/delete_task/<task_id>`

**Description:** Permanently deletes a tracking task and all associated data.

**URL Parameters:**
- `task_id` (string, required): The UUID of the tracking task to delete

**Request:** No JSON body required (DELETE request)

**Success Response (200):**
```json
{
  "result": true,
  "response": {
    "message": "Tracking task deleted successfully"
  }
}
```

**Error Responses:**
```json
// Task not found or access denied (404)
{
  "result": false,
  "message": "Task not found or access denied"
}

// Unauthorized (401)
{
  "result": false,
  "message": "Unauthorized: invalid or expired token"
}
```

**Example Usage:**
```python
task_id = "uuid-1234-5678-9abc"
response = network.send(
    f"/codvid-ai/ig-tracking/delete_task/{task_id}",
    session_token=session_token,
    method="DELETE"
)
success = response.get_dict().get("result", False)
```

---

## 5. Update Tracking Task

**Endpoint:** `PUT /codvid-ai/ig-tracking/update_task/<task_id>`

**Description:** Updates specific settings of a tracking task.

**URL Parameters:**
- `task_id` (string, required): The UUID of the tracking task to update

**Request:**
```json
{
  "schema_version": "4.0",
  "data": {
    "is_competitor": false
  }
}
```

**Request Parameters:**
- `is_competitor` (boolean, optional): Update whether this profile is a competitor

**Success Response (200):**
```json
{
  "result": true,
  "response": {
    "message": "Tracking task updated successfully"
  }
}
```

**Error Responses:**
```json
// No updatable fields provided (400)
{
  "result": false,
  "message": "No updatable fields provided"
}

// Task not found or access denied (404)
{
  "result": false,
  "message": "Task not found or access denied"
}

// Unauthorized (401)
{
  "result": false,
  "message": "Unauthorized: invalid or expired token"
}
```

**Example Usage:**
```python
task_id = "uuid-1234-5678-9abc"
data = {"is_competitor": False}
response = network.send(
    f"/codvid-ai/ig-tracking/update_task/{task_id}",
    content=data,
    session_token=session_token,
    method="PUT"
)
success = response.get_dict().get("result", False)
```

---

## 6. Force Immediate Scraping

**Endpoint:** `POST /codvid-ai/ig-tracking/force_scrape/<task_id>`

**Description:** Forces immediate scraping of a tracking task, bypassing the scheduled scraping interval.

**URL Parameters:**
- `task_id` (string, required): The UUID of the tracking task to scrape

**Request:**
```json
{
  "schema_version": "4.0",
  "data": {}
}
```

**Success Response (200):**
```json
{
  "result": true,
  "response": {
    "message": "Task scraping completed successfully",
    "posts_processed": 3,
    "comments_analyzed": 27
  }
}
```

**Error Responses:**
```json
// Task not found or access denied (404)
{
  "result": false,
  "message": "Task not found or access denied"
}

// Scraping failed (500)
{
  "result": false,
  "message": "Error scraping Instagram profile: Connection timeout"
}

// Unauthorized (401)
{
  "result": false,
  "message": "Unauthorized: invalid or expired token"
}
```

**Example Usage:**
```python
task_id = "uuid-1234-5678-9abc"
response = network.send(
    f"/codvid-ai/ig-tracking/force_scrape/{task_id}",
    content={},
    session_token=session_token
)
success = response.get_dict().get("result", False)
```

---

## 7. Get Sentiment Analysis Summary

**Endpoint:** `GET /codvid-ai/ig-tracking/sentiment_summary/<task_id>`

**Description:** Retrieves aggregated sentiment analysis results for a tracking task.

**URL Parameters:**
- `task_id` (string, required): The UUID of the tracking task

**Request:** No JSON body required (GET request)

**Success Response (200):**
```json
{
  "result": true,
  "response": {
    "sentiment_summary": {
      "total_comments": 45,
      "sentiment_distribution": {
        "positive": 28,
        "negative": 5,
        "neutral": 12
      },
      "sentiment_percentages": {
        "positive": 62.2,
        "negative": 11.1,
        "neutral": 26.7
      },
      "overall_sentiment": "positive"
    }
  }
}
```

**Error Responses:**
```json
// Task not found or no data available (404)
{
  "result": false,
  "message": "Task not found or no data available"
}

// Task not found or access denied (404)
{
  "result": false,
  "message": "Task not found or access denied"
}

// Unauthorized (401)
{
  "result": false,
  "message": "Unauthorized: invalid or expired token"
}
```

**Example Usage:**
```python
task_id = "uuid-1234-5678-9abc"
response = network.send(
    f"/codvid-ai/ig-tracking/sentiment_summary/{task_id}",
    session_token=session_token,
    method="GET"
)
sentiment_data = response.get_dict()["response"]["sentiment_summary"]
```

---

## Error Handling Best Practices

### Common Error Patterns

1. **Authentication Errors (401)**
   - Always check if the JWT token is valid and not expired
   - Refresh token if necessary before making requests

2. **Validation Errors (400)**
   - Validate input data before sending requests
   - Check required fields are present and properly formatted

3. **Not Found Errors (404)**
   - Verify task IDs exist and belong to the authenticated user
   - Handle cases where tasks may have been deleted

4. **Server Errors (500)**
   - Implement retry logic for transient failures
   - Log errors for debugging purposes

### Example Error Handling

```python
def safe_api_call(endpoint, data=None, method="POST"):
    try:
        response = network.send(
            endpoint,
            content=data,
            session_token=session_token,
            method=method
        )
        
        result = response.get_dict()
        if result and result.get("result"):
            return result["response"]
        else:
            error_msg = result.get("message", "Unknown error") if result else "No response"
            print(f"❌ API Error: {error_msg}")
            return None
            
    except Exception as e:
        print(f"❌ Request failed: {str(e)}")
        return None
```

## Notes

- **Data Privacy**: You can only access your own tracking tasks
- **Public Data**: System only tracks publicly available Instagram content
- **Automatic Processing**: Server handles all data collection automatically every 2 days